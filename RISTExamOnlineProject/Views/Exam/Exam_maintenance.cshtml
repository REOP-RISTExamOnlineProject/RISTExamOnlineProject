
@{
    ViewData["Title"] = "Exam_maintenance";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<html>

<head>

    <style>
        .initiallyHidden {
            display: none;
        }
        .modal {
            overflow-y: auto;
        }
        .note-group-select-from-files {
            display: none;
        }
    </style>

</head>

<body>



    <div class="container-fluid">

        <div class="container rounded bg-white m-auto" id="Main_Form">

            <div class="row justify-content-center m-4">
                <h2 class="m-2"> Exam Name : <label id="LB_Exam_Name"></label></h2>
            </div>



            <div id="QuestionList_Form">

                <div class="card  rounded-0  m-0 p-0">

                    <div class="card-header  bg-dark badge-dark m-0 p-0" id="heading_Question_List">
                        <div class="row justify-content-between">

                            <div class="col-3 ">
                                <h4 class="m-3 "><b>  Question List </b> </h4>

                            </div>

                            <div class="col-1">

                                @*<button class="btn btn-outline-dark border-0 m-2" data-toggle="collapse" data-target="#collapse_Question_List" aria-expanded="true" aria-controls="collaps_Question_List">
                                        <i class="fas fa-plus-square fa-2x"></i>
                                    </button>*@


                                <button class="btn btn-outline-secondary border-0 m-2" onclick="Toggle('#collapse_Question_List')">
                                    <i class="fas fa-plus-square fa-2x"></i>
                                </button>


                            </div>

                        </div>

                    </div>

                    @*<div id="collapse_Question_List" class="collapse show" aria-labelledby="heading_Question_List" data-parent="#QuestionList_Form">*@
                    <div id="collapse_Question_List" class="collapse show">

                        <div class="card-body">

                            <div class="row justify-content-between m-auto">
                                <div class="col-2">
                                    <h6> <b>  Total : <label id="LB_Exam_Count"></label> </b></h6>
                                </div>

                                <div class="col-2">
                                    <button class="btn btn-success" onclick="NewQuestion()">
                                        New Question
                                    </button>

                                </div>



                            </div>
                            <table class="table table-sm table-bordered table-striped " style="font-size:small; color:black; width:100%; background-color:#fff;" id="MyTable">

                                <thead class="thead-dark">
                                    <tr>
                                        <td>Edit</td>
                                        <td>Question</td>
                                        <td>Ans Count</td>
                                        <td>Delete</td>
                                    </tr>
                                </thead>
                            </table>






                        </div>
                    </div>
                </div>
            </div>



            @*//---------------------------------*@

        </div>

    </div>



    <div class="modal hide fade " id="Modal_Form_Main" tabindex="-1" data-focus-on="input:first">
        <div class="modal-dialog modal-lg " style="max-width:1200px;max-height:300px;">

            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><label id="LB_title"></label></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
                <div class="modal-body" id="Modal_body_Form_Main" style="overflow:auto">



                </div>
                <div class="modal-footer">



                </div>
            </div>

        </div>



    </div>




    <div class="modal hide fade" id="Modal_Summernote" tabindex="-1" data-focus-on="input:first">
        <div class="modal-dialog modal-dialog-centered modal-lg  ">
            <div class="modal-content border border-dark shadow shadow-lg rounded ">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Input Detail</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">

                    <div id="Display_Modal" class="border border-dark rounded m-3 p-3" style="min-height:30px; max-height:150px; overflow:auto;">

                    </div>
                    <textarea class="form-control " id="Summernote_modal" name="" style="height:150px; overflow:auto;"></textarea>
                    <br />

                    <div class="row justify-content-end m-3">
                        <div class="col-2">
                            <button class="btn btn-info w-100" id="BTN_Add" onclick="Add_Detail_Display('Display_Modal','Summernote_modal')">
                                <i class="fas fa-plus"></i>     Add
                            </button>

                        </div>
                        <div class="col-2">
                            <button class="btn btn-info w-100" id="BTN_Edit" onclick="Edit_Detail_Display('Display_Modal','Summernote_modal')">
                                <i class="fas fa-edit"></i> Edit
                            </button>

                        </div>

                        <div class="col-2">
                            <button class="btn btn-danger w-100" id="BTN_Reset" onclick="Reset_Summernote('Summernote_modal')">
                                <i class="fas fa-trash-alt"></i> Reset
                            </button>

                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button class="btn btn-success " id="BTN_Save" onclick="Save()">
                        <i class="fas fa-save"></i>Save Edit
                    </button>
                    <button type="button" class="btn btn-secondary " data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>



    </div>

    @section Scripts
{


        <script src="~/lib/summernote/dist/Bootstrap_4_4_1.js"></script>

        @*<script src="~/lib/jquery/jquery.min.js"></script>*@
        @*<script src="~/lib/bootstrap/js/bootstrap.min.js"></script>*@


        <link href="~/lib/summernote/dist/summernote-bs4.css" rel="stylesheet" />
        <script src="~/lib/summernote/dist/summernote-bs4.js"></script>


        <script src="~/lib/CustomJS/Exam/CommonJS.js"></script>
        <script src="~/lib/CustomJS/Exam/Create_Exam.js"></script>

        <link href="~/lib/bootstrap/css/bootstrap4-toggle.css" rel="stylesheet" />
        <script src="~/lib/bootstrap/js/bootstrap4-toggle.js"></script>

        <link href="~/lib/DataTables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/fixedColumns.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/fixedHeader.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/responsive.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/rowGroup.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/scroller.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/select.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/buttons.bootstrap4.min.css" rel="stylesheet" />
        <link href="~/lib/DataTables/css/buttons.dataTables.min.css" rel="stylesheet" />

        <script src="~/lib/DataTables/js/jquery.dataTables.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.bootstrap4.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.colReorder.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.fixedHeader.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.keyTable.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.responsive.min.js"></script>
        <script src="~/lib/DataTables/js/responsive.bootstrap4.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.rowGroup.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.rowReorder.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.scroller.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.select.min.js"></script>
        <script src="~/lib/DataTables/js/dataTables.buttons.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.bootstrap.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.flash.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.html5.min.js"></script>
        <script src="~/lib/DataTables/js/buttons.print.min.js"></script>



        <script>

                var DisplayOrder = 0
            var Exam_NO = 0
            var TempDisplayID;
            var TempHTML;
                var AnsrowCount = 1
                var AnsrowCount_Edit = 0
            //---------------------------
            var Ans_Array;
            var result = { NO: "", Value: [] };  //[0]type,[1]HTMLText,[2]Ans_Value,[3]Need
            var Need_Value
            //---------------
            var Max_Seq;
            var QuestionCount;
            var ValueCodeQuestion;
            var ValueCodeAnswer;
            var ItemName;
            var TableTarget;
            //----------------

                var OP_UPD
            $(document).ready(function () {
                //$('#CB_Need').bootstrapToggle('off')
                CheckRole()

                GetExamDetail('@ViewBag.Itemcode')
                OP_UPD = '@User.Identity.Name';


            });



            function Toggle(ID) {
                $(ID).toggle(500);
            }


            function MakeTable(Detail) {
                TableTarget = $("#MyTable").DataTable()
                if (TableTarget != null) {
                    TableTarget.destroy();
                }

                debugger
                TableTarget = $("#MyTable").DataTable({
                    //searching: false,
                    ordering: false,
                    //serverSide: true,
                    //processing: true,
                    //paging: true,

                    //deferRender: true,
                    data: Detail,
                    dom: '<"top"l>rt<"bottom">ip<"clear">',
                    columns: [
                        {
                            data: null,
                            render: function (data, type, row) {
                                var ValueCodeQuestion = row.valueCodeQuestion.trim();
                                var ValueCodeAnswer = row.valueCodeAnswer.trim();
                                var Seq = row.seq;
                                var Max_Seq_ = row.max_Seq.trim();

                                return "<a href='#' class='btn btn-info text-white' onclick=EditQuestion('"+ ValueCodeAnswer +"','"+ ValueCodeQuestion + "','" + Seq + "','" + Max_Seq_ + "') >Edit</a>";

                                //return "<a href='#' class='btn btn-info text-white' onclick=EditQuestion('" + ValueCodeAnswer + "') >Edit</a>";

                            }, class: "text-wrap text-center"
                        },
                        { data: "question", name: "question", class: "text-wrap text-left" },
                        { data: "ans_Count", name: "ans_Count", class: "text-wrap text-center" },
                        {
                            data: null,
                            render: function (data, type, row) {
                                var ValueCodeQuestion = row.valueCodeQuestion.trim();
                                var ValueCodeAnswer = row.valueCodeAnswer.trim();
                                var Seq = row.seq;

                                return "<a href='#' class='btn btn-danger  text-white' onclick=DeleteQuestion('" + ValueCodeAnswer + "','" + ValueCodeQuestion + "','" + Seq + "') ><i class='fas fa-trash-alt'></i></a>";

                                //return "<a href='#' class='btn btn-info text-white' onclick=EditQuestion('" + ValueCodeAnswer + "') >Edit</a>";

                            }, class: "text-wrap text-center"
                        },
                    ],

                    //fnInitComplete: function (oSettings, json, sData) {
                    //    TableTarget.clear().draw();
                    //    TableTarget.rows.add(Detail).draw();
                    //    debugger
                    //    return;
                    //},
                    //order: [0, "asc"],

                });



            }

                var func = $('.summernote').summernote('module', 'videoDialog').createVideoNode;

                $('.summernote').summernote('module', 'videoDialog').createVideoNode =
                    function (url) {

                        // native function generating the elements (iframe)
                        var html = func(url);
                       var a

                        return a;
                    };


            function CheckRole() {

             debugger

                if ( '@User.IsInRole("Admin")' != "True") {



                    window.location.href = "@Url.Action("index", "home")";
                }


            }




                function DeleteQuestion(ValueCodeAnswer, ValueCodeQuestion, Seq) {

                    Swal.fire({
                        icon: 'warning',
                        title: 'Are you sure?',
                        text: "Are you sure you want to Delete Question ?",
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, Delete it!'

                    }).then(function (result) {
                        if (result.value) {

                            $.ajax({
                                type: 'POST',
                                url: '../Exam/Delete_Question',
                                dataType: 'json',
                                data: { ValueCodeAnswer: ValueCodeAnswer, ValueCodeQuestion: ValueCodeQuestion, Seq: Seq },
                                success: function (response) {
                                    if (response.success == true) {


                                        Swal.fire({
                                            position: 'top-mid',
                                            icon: 'success',
                                            title: ("Delete  Question  success "),
                                            showConfirmButton: true,
                                            //   timer: 1700
                                        }).then(function (result) {

                                            location.reload();

                                        });
                                    }

                                }



                            });


                        }
                    })




                }


                function NewQuestion() {

                    var HTML_TEXT;
                    $.ajax({
                        type: 'POST',
                        url: '../Exam/Get_HTML_Question_Detail',
                        dataType: 'json',
                        data: { ValueCodeAnswer:'0', ValueCodeQuestion: '0', Seq: 0, Job:"new"},
                        success: function (response) {
                            if (response.success == true) {
                                debugger
                                $('#LB_title').text('New Question');
                                HTML_TEXT = response.html;
                                DeleteHTML('Modal_body_Form_Main');
                                InputHTML('Modal_body_Form_Main', HTML_TEXT);
                                $('#Modal_Form_Main').modal('show');
                                CountAns('new');
                            }

                        }



                    });

                }

            function EditQuestion(ValueCodeAnswer, ValueCodeQuestion, Seq, Max_Seq) {
              //  function EditQuestion(ValueCodeAnswer) {

                Max_Seq = Max_Seq;
                DisplayOrder = Seq;
                var HTML_TEXT;
                $.ajax({
                    type: 'POST',
                    url: '../Exam/Get_HTML_Question_Detail',
                    dataType: 'json',
                    data: { ValueCodeAnswer: ValueCodeAnswer, ValueCodeQuestion: ValueCodeQuestion, Seq: Seq, Job:"Edit"},
                    success: function (response) {
                        if (response.success == true) {
                            debugger
                            $('#LB_title').text('Edit Question');
                            HTML_TEXT = response.html;
                            DeleteHTML('Modal_body_Form_Main');
                            InputHTML('Modal_body_Form_Main', HTML_TEXT);
                            CountAns('Edit')
                            $('#Modal_Form_Main').modal('show')

                        }

                    }



                });



                debugger

                debugger

            }


        </script>

    }






</body>




</html>

